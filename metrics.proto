syntax = "proto3";

package pb;
option go_package = "./pb";

import "google/protobuf/timestamp.proto";

message Metrics {
  string hostname = 1;
  repeated CpuInfo cpus = 2;
  MemoryInfo memory = 3;
  DiskInfo disk = 4;
  google.protobuf.Timestamp ts = 5;
}

message CpuInfo {
  string model = 1;
  double usage_percent = 2;
  int32 cores = 3;
}

message MemoryInfo {
  uint64 total = 1;
  uint64 used = 2;
  uint64 free = 3;
  double used_percent = 4;
}

message DiskInfo {
  uint64 total = 1;
  uint64 used = 2;
  uint64 free = 3;
  double used_percent = 4;
  string path = 5;
}

message ServerMessage {
  string text = 1;
  // optional command type
  string command = 2;
}

service MonitorService {
  // bidirectional stream: client sends Metrics; server can send ServerMessage anytime
  rpc Monitor(stream Metrics) returns (stream ServerMessage);
}
